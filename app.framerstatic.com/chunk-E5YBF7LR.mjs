import{c as L,t as x,u as w,x as B}from"https://app.framerstatic.com/chunk-XRODVMEA.mjs";import{La as C,pc as z}from"https://app.framerstatic.com/chunk-FPS4GZUH.mjs";import{Ac as I,Hp as b,Rj as P,pb as S,tc as s,xc as N}from"https://app.framerstatic.com/chunk-JMNEQD26.mjs";import{b as y,i as l,l as v,o as h,r as R}from"https://app.framerstatic.com/chunk-ZQUNXESX.mjs";import{i as V}from"https://app.framerstatic.com/chunk-CQ6F5PRQ.mjs";import{a as u}from"https://app.framerstatic.com/chunk-WNSBRACC.mjs";import{j as p}from"https://app.framerstatic.com/chunk-AHQIRSXG.mjs";var M=class{constructor(t){this.environment=t;p(this,"dataByRenderId",new Map);p(this,"itemIdsByRenderId",new Map);p(this,"updatedDataByNodeId",new Map);p(this,"updatedItemIdsByRenderId",new Map)}set(t,o,n){if(u(this.environment==="sandbox","Setting data is only allowed in the sandbox."),o??=V(),this.dataByRenderId.get(t)===o)return;if(this.dataByRenderId.set(t,o),L(t)){let d=T(o,n);this.updatedDataByNodeId.set(t,d)}let r=o.map(B),a=this.itemIdsByRenderId.get(t);S(r,a)||(this.itemIdsByRenderId.set(t,r),this.updatedItemIdsByRenderId.set(t,r))}import(t){u(this.environment==="editor","Importing data is only allowed in the editor.");let{dataUpdates:o,itemIdsUpdates:n}=t,e=new Set;for(let{nodeId:r,data:a}of o)this.dataByRenderId.set(r,a),e.add(r);for(let{renderId:r,itemIds:a}of n)this.itemIdsByRenderId.set(r,a),e.add(r);return e}isEmpty(t){let o=this.dataByRenderId.get(t);return!o||o.length===0}getData(t){return this.dataByRenderId.get(t)}getItemIds(t){return this.itemIdsByRenderId.get(t)}export(){u(this.environment==="sandbox","No need to collect and send updates from within the editor.");let t=[];for(let[n,e]of this.updatedDataByNodeId)t.push({nodeId:n,data:e});this.updatedDataByNodeId.clear();let o=[];for(let[n,e]of this.updatedItemIdsByRenderId)o.push({renderId:n,itemIds:e});return this.updatedItemIdsByRenderId.clear(),{dataUpdates:t,itemIdsUpdates:o}}};function T(i,t){return i.map(o=>{let n={};for(let[e,r]of t)if(r)switch(r.type){case"vectorsetitem":n[e]=void 0;continue;case"richtext":n[e]=o[e]?"<p>Content</p>":null;continue;case"object":throw Error("Not currently handled in removeNonSerializableData");case"slot":throw Error("Should never be part of collection data");default:n[e]=o[e]}return n})}function Z(i){let t=new Map;for(let o of i)o.type!=="divider"&&t.set(o.id,o);return t}function U(i,t,o,n,e,r){if(t.type!=="string"||y(o?.value))return;let a=n.get(i);if(a?.type!=="string"||a.fallbackValue!=="associatedVariable")return;let d=a.associatedStringVariable;if(h(d))return;let c=r.getControlProp(d),f=e[d];if(l(f))return;let g=b(f,c);if(g?.type==="string")return g}function _(i,t,o,n,e){let r=e.getControlProp(i),d=U(i,t,r,o,n,e)??b(t,r);if(w(d))return d}function k({control:i,controlProp:t,resolvers:o,locale:n}){switch(t.type){case"array":{u(i.type==="array","Invalid control");let{value:e}=t;if(s(e))return;let r=e.map(a=>k({control:i.control,controlProp:a,resolvers:o,locale:n})??null);return{type:"array",value:r}}case"boolean":{let{value:e}=t;return s(e)?void 0:{type:"boolean",value:e}}case"collectionreference":{let{value:e}=t;return s(e)||l(e)?void 0:{type:"string",value:e}}case"color":{let{value:e}=t;if(s(e)||v(e))return;let r=o.resolveColor(e);return l(r)?void 0:{type:"color",value:r}}case"date":{u(i.type==="date","Invalid control");let{value:e}=t;if(s(e)||l(e))return;let r=new Date(e);return R(r)?(i.displayTime||r.setUTCHours(0,0,0,0),{type:"date",value:r.toISOString()}):void 0}case"enum":{let{value:e}=t;return s(e)||l(e)?void 0:(u(y(e),"Enum is not a string"),{type:"enum",value:e})}case"file":{let{value:e}=t;if(s(e)||l(e))return;let r=o.resolveFile(e);return l(r)?void 0:{type:"file",value:r}}case"image":{let e=m(i,t.valueLocalized,n),r=e?.value??t.value;if(s(r)||l(r))return;let a=e?.imageFocalPoint??t,d=o.resolveImage(r,a);if(l(d))return;let f=m(i,t.altLocalized,n)?.value??t.alt;return{type:"responsiveimage",value:{...d,alt:f}}}case"link":{let e=I(t.value);if(N(e)){let a=m(i,t.valueLocalized,n);a?.value&&(e=I(a.value))}if(s(e)||l(e))return;let r=o.resolveLink(e);return l(r)?void 0:{type:"link",value:r}}case"multicollectionreference":{let{value:e}=t;return s(e)||l(e)?void 0:{type:"array",value:e.map(r=>({type:"string",value:r}))}}case"number":{let{value:e}=t;return s(e)?void 0:{type:"number",value:e}}case"object":{u(i.type==="object","Invalid control");let{value:e}=t;if(s(e)||v(e))return;let r=z(i.controls,(a,d)=>{let c=e[a];return c?k({control:d,controlProp:c,resolvers:o,locale:n})??null:null});return P(t)&&(r[C]={type:"string",value:t.id}),{type:"object",value:r}}case"richtext":{let r=m(i,t.valueLocalized,n)?.value??t.value;if(s(r)||x(r))return;let a=o.resolveRichTextPointer(r);return l(a)?void 0:{type:"richtext",value:a}}case"string":{let r=m(i,t.valueLocalized,n)?.value??t.value;return s(r)?void 0:{type:"string",value:r}}case"vectorsetitem":{let{value:e}=t;if(s(e)||l(e))return;let r=o.resolveVectorSetItemPointer(e);return l(r)?void 0:{type:"vectorsetitem",value:r}}default:}}function m(i,t,o){if(!(!t||!o||A(i)))for(;o;){let e=t[o.id];if(e&&!v(e.value))return e;o=o.fallback}}function A(i){return"preventLocalization"in i?i.preventLocalization??!1:!1}function O(i,t=o=>o){switch(i.type){case"array":{let o=O(i.control,t);return o.definitions[C]={type:t("string"),isNullable:!1},{type:t("array"),isNullable:!0,definition:o}}case"boolean":case"color":case"date":case"enum":case"file":case"link":case"number":case"richtext":case"string":return{type:t(i.type),isNullable:!0};case"collectionreference":return{type:t("string"),isNullable:!0};case"image":case"responsiveimage":return{type:t("responsiveimage"),isNullable:!0};case"multicollectionreference":return{type:t("array"),isNullable:!0,definition:{type:t("string"),isNullable:!0}};case"object":{let o=Object.entries(i.controls),n={};for(let[e,r]of o){let a=O(r,t);a&&(n[e]=a)}return{type:t("object"),isNullable:!0,definitions:n}}case"vectorsetitem":return{type:t("vectorsetitem"),isNullable:!0};default:}}export{M as a,Z as b,_ as c,k as d,O as e};
//# sourceMappingURL=https://app.framerstatic.com/chunk-E5YBF7LR.mjs.map
