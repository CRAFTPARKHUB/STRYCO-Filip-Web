import{D as ue,a as _,n as ke}from"https://app.framerstatic.com/chunk-CXMZAMHH.mjs";import{a as Ne}from"https://app.framerstatic.com/chunk-CRNX7RGT.mjs";import{c as ae,g as de}from"https://app.framerstatic.com/chunk-XRODVMEA.mjs";import{Pg as Q,Q as Te,bg as Z,qg as be,ug as we}from"https://app.framerstatic.com/chunk-FPS4GZUH.mjs";import{E as W,Pb as Me,r as Se}from"https://app.framerstatic.com/chunk-4BR6WBUV.mjs";import{B as w,Ga as Re,I as R,Ie as ie,Mc as re,Ve as xe,We as Ce,ap as ve,hm as oe}from"https://app.framerstatic.com/chunk-JMNEQD26.mjs";import{K as D}from"https://app.framerstatic.com/chunk-PPOWLCIV.mjs";import{Zd as se}from"https://app.framerstatic.com/chunk-NIDOI5EE.mjs";import{v as F}from"https://app.framerstatic.com/chunk-CQ6F5PRQ.mjs";import{a as O}from"https://app.framerstatic.com/chunk-WNSBRACC.mjs";import{j as l,k as ne,l as Ie}from"https://app.framerstatic.com/chunk-AHQIRSXG.mjs";var N=F("PartialTreeReceiver"),Ee=class{constructor(){l(this,"name","uninitialized");l(this,"tree");l(this,"chunkBuffer",new Map);l(this,"currentChunkId");l(this,"expectedTotalChunks",0);l(this,"chunkTimeout");l(this,"chunkTimeoutMs",3e4);l(this,"chunkStartTime");this.tree=Q.createWithRouteSegmentRoot()}clearChunkState(){this.chunkTimeout&&(clearTimeout(this.chunkTimeout),this.chunkTimeout=void 0),this.chunkBuffer.clear(),this.currentChunkId=void 0,this.expectedTotalChunks=0,this.chunkStartTime=void 0}update(e){if(we(Te),e.name&&(this.name=e.name),e.treeChunks)return this.handleChunkedUpdate(e.treeChunks);if(e.tree){N.debug(this.name,"received new tree",`took ${Date.now()-(e.timestamp||0)}ms to receive update`);let t=Z(e.tree.root);O(t,"error creating root from update message");let n=Q.createByAdoptingRoot(t);n.loadReplicasAndCodeComponents(n.root),this.tree=n}if(e.changes&&(N.trace(this.name,"applying changes"),be(this.tree,e.changes)),e.scopes){let t=this.tree.root.id;N.trace(this.name,"updating scopes:",e.scopes.length,`took ${Date.now()-(e.timestamp||0)}ms to receive update`);for(let n of e.scopes){let r=Z(n,t);O(r,"error creating scope from update message"),this.tree.remove(r.id),this.tree.insertNode(r,t),this.tree.loadReplicasAndCodeComponents(r)}}return this.tree.hasUncommittedChanges()&&(N.trace(this.name,"commit"),this.tree=this.tree.commitDiffs()),this.tree}handleChunkedUpdate(e){try{if(O(e.chunkIndex>=0&&e.chunkIndex<e.totalChunks,`Invalid chunk index: ${e.chunkIndex} not in range [0, ${e.totalChunks})`),(!this.currentChunkId||this.currentChunkId!==e.chunkId)&&(this.clearChunkState(),this.currentChunkId=e.chunkId,this.expectedTotalChunks=e.totalChunks,this.chunkStartTime=performance.now(),N.debug(this.name,`starting new chunked transfer: ${e.totalChunks} chunks expected`),this.chunkTimeout=setTimeout(()=>{N.warn(this.name,`chunk timeout: clearing incomplete transfer for ${e.chunkId}`),this.clearChunkState()},this.chunkTimeoutMs)),O(e.totalChunks===this.expectedTotalChunks,`Chunk count mismatch: expected ${this.expectedTotalChunks}, got ${e.totalChunks}`),this.chunkBuffer.has(e.chunkIndex))return N.warn(this.name,`duplicate chunk received: ${e.chunkIndex}`),null;this.chunkBuffer.set(e.chunkIndex,{chunkId:e.chunkId,chunkIndex:e.chunkIndex,totalChunks:e.totalChunks,nodes:e.nodes,childrenMap:e.childrenMap,rootId:e.rootId})}catch(t){return N.error(this.name,"chunk processing error:",t),this.clearChunkState(),null}if(N.debug(this.name,`received chunk ${e.chunkIndex+1}/${e.totalChunks}`),this.chunkBuffer.size===e.totalChunks){N.debug(this.name,"all chunks received, assembling tree");let t=this.assembleTreeFromChunks();return this.clearChunkState(),this.tree=t,t}return null}assembleTreeFromChunks(){let e=new Map,t=new Map,n;for(let c=0;c<this.expectedTotalChunks;c++){let m=this.chunkBuffer.get(c);if(!m)throw new Error(`Missing chunk ${c} in chunked tree transfer`);if(!m.nodes||m.nodes.size===0)throw new Error(`Chunk ${c} has no nodes`);if(m.nodes.forEach((h,f)=>{if(!h||!f)throw new Error(`Invalid node data in chunk ${c}`);e.set(f,h)}),m.childrenMap)for(let[h,f]of m.childrenMap)t.set(h,f);m.rootId&&(n=m.rootId)}if(!n)throw new Error("No root ID found in chunked tree transfer");if(e.size===0)throw new Error("No nodes found in chunked tree transfer");function r(c){let m=e.get(c);if(!m)throw new Error(`Node ${c} not found in chunks`);let h=t.get(c);return h&&h.length>0&&(m.children=h.map(r)),m}let s=r(n),i=Z(s);O(i,"error creating root from chunked tree");let a=Q.createByAdoptingRoot(i);a.loadReplicasAndCodeComponents(a.root);let d=this.chunkStartTime?performance.now()-this.chunkStartTime:0,u=d>1e3?`${(d/1e3).toFixed(2)}s`:`${Math.round(d)}ms`;return N.debug(this.name,`successfully assembled tree from ${this.expectedTotalChunks} chunks with ${e.size} nodes in ${u}`),a}};var Ae="getFontsForLoading";function ut(o){return Ae in o}function lt(o){let e=[];for(let t of o){let{class:n,properties:r,...s}=t,i={...s,properties:JSON.parse(JSON.stringify(r))};e.push(i)}return e}var ce=Re.getTaskQueue("optimizedImages",{priority:0,maxBatchSize:1,useAnimationFrame:!0});var le=[128,512],Fe=4,Oe=class{constructor(e){this.trackThumbnailLoad=e;l(this,"canRenderCanvasImage",e=>e.includes("framerusercontent.com/"));l(this,"zoom",1);l(this,"imageStates",new Map);l(this,"resizeObserver",new ResizeObserver(e=>{for(let t of e){let n=t.target,r=this.getCurrentImageState(n);if(!r||!r.inViewport)continue;let s=Math.round(t.contentRect.width/this.zoom),i=Math.round(t.contentRect.height/this.zoom);s===0||i===0||r&&r.width===s&&r.height===i||(r.width=s,r.height=i,this.computeNextImage(n,r))}}));l(this,"intersectionObserver",new IntersectionObserver(e=>{for(let t of e){let n=t.target,r=this.getCurrentImageState(n);if(!r||t.boundingClientRect.width===0||t.boundingClientRect.height===0)continue;let s=0,i=0,a=t.isIntersecting||We(t);a?(s=Math.round(t.boundingClientRect.width/this.zoom),i=Math.round(t.boundingClientRect.height/this.zoom)):(s=r.width,i=r.height),!(r&&r.width===s&&r.height===i&&r.inViewport===a)&&(r.width=s,r.height=i,r.inViewport=a,this.computeNextImage(n,r))}},{rootMargin:"50px",threshold:.05}));l(this,"renderCanvasImage",(e,t,n,r)=>{let s=e.parentElement;if(!s)return;let i=this.getOrCreateImageState(s,e,n),a=!1;a=this.updateImageSource(s,i,0,t,r),a=this.updateImageSource(s,i,1,t)||a,a=this.updateImageSource(s,i,2,t)||a,a&&(i.show=-1,this.computeNextImage(s,i),this.resizeObserver.observe(s),this.intersectionObserver.observe(s))});l(this,"scheduled",!1);l(this,"scheduledRenderings",new Set);l(this,"processRenderMainImage",()=>{this.scheduled=!1;let e=0;for(let t of this.scheduledRenderings){this.scheduledRenderings.delete(t);let n=this.imageStates.get(t);if(n&&(this.renderImage(n),n.show!==0&&(e++,e>Fe)))break}this.scheduledRenderings.size>0&&(this.scheduled=!0,ce.add(this.processRenderMainImage))})}getImageSrc(e,t){if(t===-1||t===2)return e;let n=le[t],r=e.match(/(.*?)\/assets\/(\d+)\/([^.]+\.[a-zA-Z\d]+)/);if(r)return`${r[1]}/assets/${n}/${r[3]}`;let s=e.match(/(.*?)\/assets\/([^.]+\.[a-zA-Z\d]+)/);if(s)return`${s[1]}/assets/${n}/${s[2]}`;let i=new URL(e);return i.searchParams.set("scale-down-to",String(n)),i.toString()}setZoom(e){if(this.zoom!==e){this.zoom=e;for(let[t,n]of this.imageStates)this.computeNextImage(t,n)}}getCurrentImageState(e){if(!e.isConnected){this.imageStates.delete(e),this.resizeObserver.unobserve(e),this.intersectionObserver.unobserve(e);return}return this.imageStates.get(e)}getOrCreateImageState(e,t,n){let r=this.imageStates.get(e);return r?(me(r.images[0]?.img,n,t),me(r.images[1]?.img,n,t),me(r.images[2]?.img,n,t),r):(r={width:0,height:0,inViewport:!0,error:!1,show:-1,images:[{img:he(t,n,0),src:"",loaded:!1},{img:he(t,n),src:"",loaded:!1},{img:he(t,n),src:"",loaded:!1}]},this.imageStates.set(e,r),r)}hasSmallerImageLoaded(e,t){return e.images[t-1]?.loaded??!0}loadLargerImage(e,t){for(let n=t+1;n<=2;n++){let r=e.images[t+1];if(r&&!r.loaded&&r.img.src!==r.src){r.img.src=r.src;return}}}updateImageSource(e,t,n,r,s){let i=t.images[n];if(!i)return!1;let a=this.getImageSrc(r,n);if(i.src===a)return!1;i.src=a,i.loaded=!1,i.img.style.visibility!=="hidden"&&(i.img.style.visibility="hidden");let d=!1,u;return n===0&&s&&this.trackThumbnailLoad&&this.trackThumbnailLoad(s,()=>new Promise(c=>{u=c,d?c():setTimeout(c,2e3)})),i.img.onload=()=>{d=!0,u?.(),i.src===a&&(this.loadLargerImage(t,n),i.loaded=i.img.naturalWidth>0,n===2&&(t.error=!i.loaded),this.computeNextImage(e,t))},this.hasSmallerImageLoaded(t,n)&&(i.img.src=a),!0}updateImageVisibility(e,t){let n=e.images[t]?.img.style;if(!n)return;let r=e.show===t?"visible":"hidden";n.visibility!==r&&(n.visibility=r)}computeShow(e){if(e.error)return-1;let t=e.images;if(!e.inViewport)return t[0]?.loaded?0:-1;if(this.zoom>.9)return t[2]?.loaded?2:t[1]?.loaded?1:t[0]?.loaded?0:-1;let n=window.devicePixelRatio??1,r=Math.max(e.width,e.height)*this.zoom*n;return r<=le[0]?t[0]?.loaded?0:-1:r<=le[1]?t[1]?.loaded?1:t[0]?.loaded?0:-1:t[2]?.loaded?2:t[1]?.loaded?1:t[0]?.loaded?0:-1}computeNextImage(e,t){let n=this.computeShow(t);if(t.show===n)return;let r=n<=0||n<t.show;t.show=n,r?this.renderImage(t):this.scheduleRenderMainImage(e)}renderImage(e){this.updateImageVisibility(e,0),this.updateImageVisibility(e,1),this.updateImageVisibility(e,2)}scheduleRenderMainImage(e){this.scheduledRenderings.add(e),this.scheduled||(this.scheduled=!0,ce.add(()=>ce.add(this.processRenderMainImage)))}};function We(o){let e=o.intersectionRect;return e.width>5||e.height>5}function he(o,e,t){let n=new Image;return n.loading=t===0?"eager":"lazy",Object.assign(n.style,e),n.style.position="absolute",o.appendChild(n),n}function me(o,e,t){o&&(Object.assign(o.style,e),o.style.position="absolute",o.isConnected||t.appendChild(o))}var bt=F("MeasureContext"),fe=D.isChrome(),pe=D.isFirefox(),ee=D.isEdge(),ge=D.isWebKit(),z=_e();function te(){return window?.devicePixelRatio||0}var B=new DOMMatrixReadOnly;var X,J=class{constructor(){l(this,"computedStyleCache",new Map);l(this,"sizeCache",new Map);l(this,"boundingClientRectCache",new Map);l(this,"matrixCache",new Map);l(this,"transformMatrixAndOffsetCache",new Map);l(this,"untransformedRectCache",new Map);Ie(this,X,new Map)}getComputedStyle(e){let t=this.computedStyleCache.get(e);return t||(t=getComputedStyle(e),this.computedStyleCache.set(e,{display:t.display,width:t.width,height:t.height,transform:t.transform,opacity:t.opacity,filter:t.filter,overflow:t.overflow,transformStyle:t.transformStyle,transformOrigin:t.transformOrigin,zIndex:t.zIndex}),t)}getCreates3dTransformContext(e){let t=this.getComputedStyle(e);return!(t.transformStyle!=="preserve-3d"||t.opacity!=="1"||t.filter!=="none"||t.overflow!=="visible"&&t.overflow!=="none")}transformOriginPoint(e,t=e/2){if(e===0)return 0;let n=Math.round(t/e*100)/100;return ge?Xe(e)*n:e*n}getTransformOrigin(e){let t=ne(this,X).get(e);if(t)return t;let n=this.getComputedStyle(e),{width:r,height:s}=this.getSize(e),i=n.transformOrigin;if(!i)return{x:this.transformOriginPoint(r,.5),y:this.transformOriginPoint(s,.5)};let a=Je(i),d={x:this.transformOriginPoint(r,a?.x),y:this.transformOriginPoint(s,a?.y)};return ne(this,X).set(e,d),d}getCachedSize(e){return e?this.sizeCache.get(e):void 0}getCachedAttributes(e){let t=this.computedStyleCache.get(e),n=t?.zIndex?parseInt(t.zIndex):void 0,r=this.getTransformOrigin(e),s=this.getMatrix(e);return{zIndex:n,originX:r.x,originY:r.y,matrix:s.toJSON()}}getSize(e){let t=this.sizeCache.get(e);if(t)return t;let n=this.getComputedStyle(e),r=()=>{let d=e instanceof HTMLElement?e.offsetWidth:e.clientWidth;return n.display.startsWith("inline")?d+1:d},s=()=>e instanceof HTMLElement?e.offsetHeight:e.clientHeight,i=n.width.endsWith("px")?parseFloat(n.width):r(),a=n.height.endsWith("px")?parseFloat(n.height):s();return t={width:i||0,height:a||0},this.sizeCache.set(e,t),t}getCSSTransform(e){return this.getComputedStyle(e).transform||"none"}hasTransforms(e){return pe?this.getCSSTransform(e)!=="none":!this.getMatrix(e).isIdentity}getMatrix(e){let t=this.matrixCache.get(e);if(t)return t;let n=this.getCSSTransform(e);return t=n==="none"?B:new DOMMatrix(n),this.matrixCache.set(e,t),t}getBoundingClientRect(e){let t=this.boundingClientRectCache.get(e);return t||(t=e.getBoundingClientRect(),this.boundingClientRectCache.set(e,t),t)}getUntransformedRectInGroundNode(e,t,n=!0){let r=this.untransformedRectCache.get(e);if(r)return r;let s=this.getTransformAncestors(e),i={x:0,y:0,paintX:0,paintY:0,translationX:0,translationY:0},a=B,d={x:0,y:0,width:0,height:0};return[...s,e].forEach(c=>{let m=this.getSize(c),h=this.getBoundingClientRect(c),f=this.getMatrix(c),y=n?f.m41/f.m44:0,T=n?f.m42/f.m44:0,{x:I,y:p}=this.getTransformOrigin(c),C=B.translate(I,p).multiplySelf(f).translateSelf(-I,-p),x=R.pointsAtOrigin(m),g=R.fromPoints(R.points(h).map(E=>t.transformPoint(E))),{x:Y,y:P,matrix:v}=Ne(a,C,g,x),k=w(V(Y+y),V(P+T)),U=w(M(k.x),M(k.y)),H=this.hasTransforms(c),G=W.hasNonTranslationTransform(f),b=Qe(c),{rect:A,paintDelta:L,translation:q}=Ze(i,k,m,f,H,b),$=Be(H,G,b,k,U);i.x+=$.x,i.y+=$.y,i.paintX+=L.x,i.paintY+=L.y,i.translationX+=q.x,i.translationY+=q.y,a=this.getCreates3dTransformContext(c)?v:W.flatProjectionMatrix(v),this.transformMatrixAndOffsetCache.set(c,{matrix:a,offset:{...i}}),this.untransformedRectCache.set(c,A),d=A}),d}getTransformAncestors(e){let t=[],n=e.parentElement;for(;n!=null&&!Pe(n)&&n!==e.ownerDocument?.documentElement;)this.hasTransforms(n)&&t.unshift(n),n=n.parentElement;return t}getOffsetParentBoundingRect(e){if(!(e instanceof HTMLElement&&e.dataset.framerOffsetParentId))return;let t=document.getElementById(e.dataset.framerOffsetParentId);if(t)return this.getBoundingClientRect(t)}getOffsetParent(e){let t=e instanceof HTMLElement?e.offsetParent??e.parentElement:e.parentElement;return t instanceof HTMLElement&&t.dataset.layoutTemplateRoot?this.getOffsetParent(t):t}getParentRelativeRect(e,t,n,r){let s=this.getUntransformedRectInGroundNode(e,t,r),i=s,a,d,u=this.getOffsetParentBoundingRect(e);if(u){let h=t.transformPoint(new DOMPoint(u.x,u.y));return{x:s.x-h.x,y:s.y-h.y,width:s.width,height:s.height}}let c=this.getOffsetParent(e);return c&&!Pe(c)?(i=this.getUntransformedRectInGroundNode(c,t),a=s.x-i.x,d=s.y-i.y):n?(a=n.x,d=n.y):(a=0,d=0),{x:a,y:d,width:s.width,height:s.height}}};X=new WeakMap;function Pe(o){return o.classList.contains(ue)||o.parentElement?.classList.contains(ue)}function Be(o,e,t,n,r){return pe&&o?r:(fe||ee)&&e?{x:t.includes(0)?n.x:r.x,y:t.includes(1)?n.y:r.y}:n}function He(o){let e=te();if(e<2)return Math.round(V(o));let t=Le(o)/z;return _(t*e,0)/e}function Ge(o){return te()<2?Math.round(V(o)):Math.round(V(o)*2)/2}function $e(o){let e=Le(o),t=0,n=e%z,r=Math.trunc(e/z)*z;return te()<=1?(n>=32&&(t=64),n<-32&&(t=-64)):(n>=16&&n<48&&(t=32),n>=48&&(t=64),n<-16&&n>=-24&&(t=-24),n<-24&&n>=-48&&(t=-32),n<-48&&n>=-56&&(t=-56),n<-56&&(t=-64)),(r+t)/z}function Ve(){return fe||ee?Ge:ge?$e:He}var M=Ve();function K({x:o,y:e,width:t,height:n}){let r=M(o),s=M(e);return{x:r,y:s,width:M(o+t)-r,height:M(e+n)-s}}function Xe(o){let e=te();return _(o*e,0)/e}function V(o){return _(o*z,0)/z}function Le(o){return Math.trunc(o*z)}function Ye({x:o,y:e,width:t,height:n},r){let{rotation:s,translation:i}=ye(r),a=w(o-i.x,e-i.y),d=K({...a,width:t,height:n}),u=w(d.x+M(t)/2,d.y+M(n)/2),c=B.translate(u.x+i.x,u.y+i.y).rotateSelf(s).translateSelf(-u.x,-u.y),m=W.convertPoint(c,R.center(d)),h=m.x-d.width/2,f=m.y-d.height/2;return{paintedRect:{x:h,y:f,width:d.width,height:d.height},snappedLayoutRect:d,translation:i}}function Ue({x:o,y:e,width:t,height:n},r,s=[]){let{rotation:i,translation:a}=ye(r);s.includes(0)&&(a.x=-.5*t),s.includes(1)&&(a.y=-.5*n);let d=w(o-a.x,e-a.y),u=K({...d,width:t,height:n}),c=Math.round(t),m=Math.round(n),h=i!==0?c:u.width,f=i!==0?m:u.height,y=w(u.x+t/2,u.y+n/2),T=B.translate(y.x+a.x,y.y+a.y).rotateSelf(i).translateSelf(-y.x,-y.y),I=w(u.x+h/2,u.y+f/2),p=W.convertPoint(T,I),C=p.x-h/2,x=p.y-f/2;return{paintedRect:{x:C,y:x,width:h,height:f},snappedLayoutRect:u,translation:a}}function je(o,e,{width:t,height:n},r){let{rotation:s,translation:i}=ye(r),a=w(e.x-i.x,e.y-i.y),d=o.x+M(a.x),u=o.y+M(a.y),c=w(d+t/2,u+n/2),m=B.translate(c.x+i.x,c.y+i.y).rotateSelf(s).translateSelf(-c.x,-c.y),h=W.convertPoint(m,w(d+t/2,u+n/2)),f=h.x-t/2,y=h.y-n/2;return{x:f,y,width:t,height:n}}function Ze(o,e,t,n,r,s){let i={x:0,y:0},a={x:-o.paintX,y:-o.paintY},d={x:o.translationX,y:o.translationY},u={x:o.x-d.x+e.x,y:o.y-d.y+e.y,...t};if(ge){let y=K(u),T=R.offset(y,{x:d.x+a.x,y:d.y+a.y});if(r){let{paintedRect:I,snappedLayoutRect:p,translation:C}=Ye(u,n),x=R.offset(I,{x:d.x+a.x,y:d.y+a.y}),g=R.offset(p,C);return i={x:g.x-I.x,y:g.y-I.y},{rect:x,paintDelta:i,translation:C}}return{rect:T,paintDelta:i,translation:{x:0,y:0}}}if(fe||ee){let y=K(u),T=R.offset(y,{x:d.x+a.x,y:d.y+a.y});if(r){let{paintedRect:I,snappedLayoutRect:p,translation:C}=Ue(u,n,s),x=R.offset(I,{x:d.x+a.x,y:d.y+a.y}),g=R.offset(p,C);return i={x:g.x-I.x,y:g.y-I.y},{rect:x,paintDelta:i,translation:C}}return{rect:T,paintDelta:i,translation:{x:0,y:0}}}let c=o.x+e.x,m=o.y+e.y,h={x:c,y:m,...t};if(r){let y=R.offset({x:o.x+M(e.x),y:o.y+M(e.y),width:h.width,height:h.height},a),T=R.offset(je(o,e,t,n),a);return i={x:y.x-T.x,y:y.y-T.y},{rect:T,paintDelta:i,translation:{x:0,y:0}}}return{rect:R.offset(h,a),paintDelta:i,translation:{x:0,y:0}}}function ye(o){let e=Math.atan2(o.b,o.a)*(180/Math.PI),t={x:o.e,y:o.f};return{rotation:e,translation:t}}function Qe(o){let e=[];return o instanceof HTMLElement&&(o.dataset.framerLayoutHintCenterX&&e.push(0),o.dataset.framerLayoutHintCenterY&&e.push(1)),e}function _e(){return pe?60:ee?100:64}function Je(o){let[e,t]=o.split(" ").map(n=>parseFloat(n));if(!(!se(e)||!se(t)))return{x:e,y:t}}var S=F("LayoutMeasureQueue"),Ke=new DOMMatrixReadOnly,qe=D.isFirefox()?1:0,ze=class{constructor({shouldMeasureCallback:e,shouldMeasureCallbackDelayMs:t,renderingStateTracker:n}={}){l(this,"measureRequests",new Map);l(this,"measureRequestIds",new Set);l(this,"refinementRequests",new Map);l(this,"refinementRequestsByGroundNodeId",new Map);l(this,"richTextRenderIds",new Set);l(this,"previousScopeNodeId","");l(this,"previousZoomLevel");l(this,"previousGroundNodesInViewport");l(this,"resizeObserver",null);l(this,"shouldMeasureTimerStarted",!1);l(this,"shouldMeasureCallback");l(this,"shouldMeasureCallbackDelay");l(this,"renderingStateTracker");l(this,"runShouldMeasureCallback",()=>{this.shouldMeasureTimerStarted=!1,this.size()!==0&&this.shouldMeasureCallback&&this.shouldMeasureCallback()});l(this,"resized",(e,t)=>{if(this.resizeObserver===t)for(let n of e){let r=n.target;if(!r.isConnected||!r.id)return;let s=re(r.id);this.add(s,r)}});this.shouldMeasureCallback=e,this.shouldMeasureCallbackDelay=t??100,this.renderingStateTracker=n}getRequestId(e,t){return t?`${e}-${t}`:e}add(e,t,n,r){if(S.trace("layout measure queue:",e),r&&O(ae(e),"Layout templates should only have a primary rendering"),!n&&this.measureRequests.has(t))return;let s=de(e);this.measureRequests.set(t,{nodeId:s,renderId:e,layoutTemplateSelector:r,children:n});let i=this.getRequestId(e,r);this.measureRequestIds.add(i),this.shouldMeasureCallback&&!this.shouldMeasureTimerStarted&&(setTimeout(this.runShouldMeasureCallback,this.shouldMeasureCallbackDelay),this.shouldMeasureTimerStarted=!0)}stylePresetChanged(e){for(let t of this.richTextRenderIds){let n=e.get(t);this.remeasureNodeAndAncestors(e,n)}this.richTextRenderIds.clear()}remeasureNode(e){this.remeasureCachedElements(e,(t,n)=>{S.trace("remeasureNode:",t,n)})}remeasureCachedElements(e,t){if(e.cache.elementByRenderId)for(let[n,r]of e.cache.elementByRenderId){let s=this.getRequestId(n,void 0);this.measureRequestIds.has(s)||(this.add(n,r,void 0,void 0),t?.(n,void 0))}if(e.cache.elementByLayoutTemplateSelector)for(let[n,r]of e.cache.elementByLayoutTemplateSelector){let s=this.getRequestId(e.id,n);this.measureRequestIds.has(s)||(this.add(e.id,r,void 0,n),t?.(e.id,n))}}remeasureNodeAndAncestors(e,t){t&&(this.remeasureCachedElements(t),this.remeasureNodeAndAncestors(e,e.getNodeParent(t)))}remeasureChildrenWithDOMRects(e){if(S.trace("remeasureChildrenWithLayout:",e.id),!!e.children&&!ie(e))for(let t of e.children)ve(t)&&!t.usesDOMRectCached()||this.remeasureCachedElements(t,(n,r)=>{S.trace("remeasureChildrenWithLayout, child:",n,r)})}remeasureLayoutChildren(e){if(S.trace("remeasureLayoutChildren:",e.id),!!ie(e))for(let t of e.children)this.remeasureCachedElements(t,(n,r)=>{S.trace("remeasureLayoutChildren, child:",n,r)})}remeasureAutosizingAncestors(e,t){!t||!t.children||(S.trace("remeasureAutosizingAncestors:",t.id),this.remeasureLayoutChildren(t),oe(t)&&(t.widthType!==2&&t.heightType!==2||(this.remeasureCachedElements(t,(n,r)=>{S.trace("remeasureAutosizingAncestors, add:",n,r)}),this.remeasureAutosizingAncestors(e,e.getNodeParent(t)))))}process({scopeId:e,zoom:t,offsetX:n,offsetY:r,tree:s,groundNodesInViewport:i}){this.previousScopeNodeId!==e&&(S.debug("switching to a new page",this.previousScopeNodeId,e),this.richTextRenderIds.clear(),this.refinementRequests.clear(),this.refinementRequestsByGroundNodeId.clear(),De(s.get(this.previousScopeNodeId)),this.previousScopeNodeId=e,this.resizeObserver&&this.resizeObserver.disconnect(),this.resizeObserver=new ResizeObserver(this.resized));let a=this.previousZoomLevel!==void 0&&t!==this.previousZoomLevel;this.previousZoomLevel=t;let d=this.previousGroundNodesInViewport!==void 0&&i!==this.previousGroundNodesInViewport,u=new Set([...i]),c=new Set;if(this.previousGroundNodesInViewport!==void 0)for(let p of i)this.previousGroundNodesInViewport.has(p)&&(u.delete(p),c.add(p));if(this.previousGroundNodesInViewport=i,d&&this.processRefinementRequests(u),(d||a)&&t>qe&&this.processRefinementRequests(c),S.trace("process:",this.size()),this.size()===0)return[];let m=Ke.scale(t).translateSelf(-n,-r),h=[],f=new Map,y=new J;for(let[p,C]of this.measureRequests){let x=s.getNode(C.nodeId);x&&(this.remeasureAutosizingAncestors(s,s.getNodeParent(x)),this.remeasureChildrenWithDOMRects(x),this.remeasureLayoutChildren(x))}let T=et(this.measureRequests.values(),s,m),I=new Set;for(let[p,C]of this.measureRequests){let{nodeId:x,renderId:g,children:Y,layoutTemplateSelector:P}=C,v=s.getNode(x);if(!v)continue;if(!p.isConnected){S.trace("measureRequest: not connected",g);continue}P?(O(ae(g),"Layout templates should only have a primary rendering"),v.cache.elementByLayoutTemplateSelector??=new Map,v.cache.elementByLayoutTemplateSelector.set(P,p)):(v.cache.elementByRenderId??=new Map,v.cache.elementByRenderId.set(g,p));let k=T.get(x),U=k.matrix,H=k.rect;if(!i.has(k.id)){this.addRefinementRequest(g,{element:p,groundNodeId:k.id,measureRequest:C}),S.trace("measureRequest: refine",g);continue}let G;if(Y){G=[];for(let L of Y){if(ke(L))continue;let q=re(L.id),$=de(q),E=f.get(L);if(E||(E=y.getParentRelativeRect(L,U,H),f.set(L,E),q&&h.push({nodeId:$,renderId:q,layoutMetrics:E})),q){let j=s.getNode($);if(j&&(R.equals(j.cache.getRawDOMRect(g),E)||I.add(q),j.cache.setRawDOMRect(g,E),!Se(j,v)))continue}G.push(E)}}let b=f.get(p);b?S.trace("measureRequest: cached",g,b):(b=y.getParentRelativeRect(p,U,H,!P),f.set(p,b),S.trace("measureRequest: getParentRelativeRect",g,b)),t<=qe&&this.addRefinementRequest(g,{element:p,groundNodeId:k.id,measureRequest:C});let A={...b};P?Object.assign(A,y.getCachedAttributes(p)):A.childrenRects=G,v&&(xe(v)?this.richTextRenderIds.add(v.id):Ce(v)&&this.resizeObserver?.observe(p),!P&&!R.equals(v.cache.getRawDOMRect(g)??null,b)&&(I.add(g),v.cache.setRawDOMRect(g,b))),h.push({nodeId:x,renderId:g,layoutTemplateSelector:P,layoutMetrics:A})}return this.measureRequests.clear(),this.measureRequestIds.clear(),I.size>0&&this.renderingStateTracker?.processNodesWithChangedRects(I),h}size(){return this.measureRequests.size}addRefinementRequest(e,t){let n=this.refinementRequests.get(e);if(n&&n.groundNodeId&&this.refinementRequestsByGroundNodeId.get(n.groundNodeId)?.delete(n),this.refinementRequests.set(e,t),t.groundNodeId){let r=this.refinementRequestsByGroundNodeId.get(t.groundNodeId);r||(r=new Set,this.refinementRequestsByGroundNodeId.set(t.groundNodeId,r)),r.add(t)}}processRefinementRequests(e){for(let t of e){let n=this.refinementRequestsByGroundNodeId.get(t);if(!(!n||n.size===0)){for(let r of n){if(this.refinementRequests.delete(r.measureRequest.renderId),!r.element.isConnected)continue;let s=this.getRequestId(r.measureRequest.renderId,r.measureRequest.layoutTemplateSelector);this.measureRequestIds.has(s)||(S.trace("refine:",r.measureRequest.renderId),this.measureRequests.set(r.element,r.measureRequest))}n.clear()}}}};function et(o,e,t){let n=new Map,r=new Map;for(let{nodeId:s}of o){let i=t,a=e.get(s),d=[],u=a;for(;u&&e.getParent(u.id);){let c=r.get(u.id);if(c){u=e.get(c);break}u=e.getParent(u.id),u&&d.push(u.id)}if(u&&oe(u)){i=n.get(u.id)?.matrix||i.translate(u.left||0,u.top||0).inverse();for(let m of d)r.set(m,u.id)}else i=i.inverse();n.set(s,{id:u?.id,matrix:i,rect:u?Me(u):null})}return n}function De(o){if(!o)return;o.cache.elementByRenderId=void 0,o.cache.elementByLayoutTemplateSelector=void 0;let e=o.children;if(e)for(let t of e)De(t)}export{Ee as a,ut as b,lt as c,Oe as d,ze as e};
//# sourceMappingURL=https://app.framerstatic.com/chunk-YJFD5HSA.mjs.map
